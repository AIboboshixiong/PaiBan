# 架构设计：赛博排版大师 (Cyber-Gong-ZH)

## 1. 技术栈体系
*   **核心框架**: React 18 (TypeScript)
*   **构建工具**: Vite (极速热更新)
*   **样式模型**: 
    *   **全局**: Vanilla CSS (用于 UI 自定义滚动条与基础布局)
    *   **注入层**: 纯内联样式模板 (Inline-Style String Template)
*   **状态管理**: 实现了一套轻量级的 **Undo/Redo 历史快照栈**。
*   **模拟引擎**: `ResizeObserver` 驱动的响应式缩放系数算法。

## 2. 核心模块分解

### 2.1 轻量级解析引擎 (`src/utils/cyber-parser.ts`)
不同于传统的 `marked` 或 `markdown-it`，本项目采用自研的正则表达式行分析器。
*   **设计初衷**: 微信公众号编辑器会对外部 CSS 进行大规模剪裁。通过正则在转换瞬间注入 `style="..."`，是保证样式 100% 兼容的唯一方案。
*   **解析逻辑**: 逐行扫描 -> 状态机判断（代码块/表格/列表等） -> 样式模板替换 -> 字符串拼接。

### 2.2 响应式手机模拟器 (`src/App.tsx -> PhoneShell`)
*   **比例锁定**: 模拟真实的 iPhone 物理尺寸比例。
*   **缩放算法**: `scale = Math.min(containerWidth / shellWidth, containerHeight / shellHeight)`。
*   **外观模拟**: 支持灵动岛 (Dynamic Island) 与 经典刘海屏 (Notch) 的 CSS 模拟。

### 2.3 历史记录快照系统
*   **结构**: 利用数组 `history: string[]` 存储内容快照，通过 `historyIndex` 指针控制状态回退。
*   **防护**: 阻止非预期的浏览器默认重做行为，确保工具栏按钮与键盘操作同步。

## 3. 目录结构
```text
/
├── src/
│   ├── utils/
│   │   └── cyber-parser.ts   # 【解析大脑】存放不同主题的样式配置与正则引擎
│   ├── App.tsx               # 【交互中心】集成编辑器、预览区、历史记录与缩放逻辑
│   ├── index.css             # 【基础皮肤】自定义滚动条与淡雅底色定义
│   └── main.tsx              # 项目入口
├── 架构设计.md                # 本文档
└── 用户使用手册.md             # 用户指南
```

## 4. 扩展性设计
*   **新增主题**: 只需在 `cyber-parser.ts` 的 `CYBER_THEMES` 对象中新增主色、辅助色及各 HTML 标签的样式模板即可。
*   **新增机型**: 在 `App.tsx` 的 `PhoneShell` 组件中通过尺寸常量进行扩展。

---
**由 AIboboshixiong 维护 | 2026**
